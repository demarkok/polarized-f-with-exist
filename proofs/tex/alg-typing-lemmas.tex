Let us extend the declarative typing metric (\cref{def:decl-typing-metric}) 
to the algorithmic typing.

\begin{definition}[Size of an Algorithmic Judgement]

    \label{def:algorithmic-typing-size}
    For an algorithmic typing judgement $J$
    let us define a metrics $\size{J}$ as a pair of numbers 
    in the following way:
    \begin{itemize}
        \item [$+$] $\size{[[Γ ; Φ ⊨ v : iP]]} = (\size{[[v]]}, 0)$;
        \item [$-$] $\size{[[Γ ; Φ ⊨ c : iN]]} = (\size{[[c]]}, 0)$;
        \item [$\bullet$] $\size{[[Γ ; Φ ; Θ ⊨ uN ● args ⇒> uM ⫤ Θ'; SC]]} = 
            (\size{[[args]]}, \npq{[[uN]]})$)
    \end{itemize}
\end{definition}

\begin{definition}[Metric]
    We extend the metric from \cref{def:decl-typing-metric} to the algorithmic typing
    in the following way.
    For a tree $T$ inferring an algorithmic typing judgement $J$, we define 
    $\size{T}$ as $(\size{J}, 0)$.
\end{definition}

Soundness and the completeness are proved by mutual induction on
the metric of the inference tree.

\begin{lemma}[Soundness of typing] \label{lemma:typing-soundness}
    Suppose that $[[Γ ⊢ Φ]]$.
    For an inference tree $T_1$,
    \hfill
    \begin{itemize}
        \item [$+$] If $T_1$ infers $[[Γ; Φ ⊨ v : iP]]$ then $[[Γ ⊢ iP]]$ and $[[Γ; Φ ⊢ v : iP]]$
        \item [$-$] If $T_1$ infers $[[Γ; Φ ⊨ c : iN]]$ then $[[Γ ⊢ iN]]$ and $[[Γ; Φ ⊢ c : iN]]$
        \item  For $[[Γ ⊢ Θ]]$ and $[[Γ; Θ ⊢ uN]]$ free from negative metavariables,
            if $T_1$ infers $[[Γ; Φ; Θ ⊨ uN ● args ⇒> uM ⫤ Θ'; SC]]$ then
            \begin{enumerate}
                \item $[[Γ ⊢ Θ']]$
                \item $[[Θ ⊆ Θ']]$
                \item $[[Γ; Θ' ⊢ uM]]$
                \item $[[uM]]$ is normalized and free from negative metavariables
                \item $[[Θ' ⊢ SC]]$
                \item for any $[[Θ' ⊢ uσ : SC]]$, we have $[[ Γ ; Φ ⊢ [uσ]uN ● args ⇒> [uσ]uM ]]$
            \end{enumerate}
    \end{itemize}
\end{lemma}
\begin{proof}
    We prove it by induction on $\metric{T_1}$, mutually with 
    the completeness of typing (\cref{lemma:typing-soundness}).
    Let us consider the last rule used to infer the derivation.
    \begin{caseof}
        \item \ruleref{\ottdruleATVarLabel}
            We are proving that if $[[Γ; Φ ⊨ x : nf(iP)]]$
            then $[[Γ ⊢ nf(iP)]]$ and $[[Γ; Φ ⊢ x : nf(iP)]]$.

            By inversion, $[[x : iP ∊ Φ]]$.
            Since $[[Γ ⊢ Φ]]$, we have $[[Γ ⊢ iP]]$,
            and by \cref{corollary:wf-nf}, $[[Γ ⊢ nf(iP)]]$.

            By applying \ruleref{\ottdruleDTVarLabel}
            to $[[x : iP ∊ Φ]]$, we infer $[[Γ; Φ ⊢ x : iP]]$.
            Finally, by \ruleref{\ottdruleDTPEquivLabel}, 
            since $[[Γ ⊢ iP ≈ nf(iP)]]$ 
            (\cref{corollary:nf-sound-wrt-subt-equiv}),
            we have $[[Γ; Φ ⊢ x : nf(iP)]]$.

        \item \ruleref{\ottdruleATThunkLabel}
            \label{case:typing-soundness:thunk}

            We are proving that if $[[Γ; Φ ⊨ {c} : ↓iN]]$
            then $[[Γ ⊢ ↓iN]]$ and $[[Γ; Φ ⊢ {c} : ↓iN]]$.

            By inversion of $[[Γ; Φ ⊨ {c} : ↓iN]]$, 
            we have $[[Γ; Φ ⊨ c : iN]]$.
            By the induction hypothesis applied to $[[Γ; Φ ⊨ c : iN]]$,
            we have 
            \begin{enumerate}
                \item $[[Γ ⊢ iN]]$, and hence, $[[Γ ⊢ ↓iN]]$;
                \item $[[Γ; Φ ⊢ c : iN]]$, 
                    which by \ruleref{\ottdruleDTThunkLabel} implies
                    $[[Γ; Φ ⊢ {c} : ↓iN]]$.
            \end{enumerate}

        \item \ruleref{\ottdruleATReturnLabel}
            The proof is symmetric to the previous case
            (\cref{case:typing-soundness:thunk}).

        \item \ruleref{\ottdruleATPAnnotLabel}
            \label{case:typing-soundness:pos-annot}
            We are proving that if $[[Γ; Φ ⊨ (v : iQ) : nf(iQ)]]$
            then $[[Γ ⊢ nf(iQ)]]$ and $[[Γ; Φ ⊢ (v : iQ) : nf(iQ)]]$.

            By inversion of $[[Γ; Φ ⊨ (v : iQ) : nf(iQ)]]$,
            we have:
            \begin{enumerate}
                \item $[[Γ ⊢ (v : iQ)]]$, hence, $[[Γ ⊢ iQ]]$, 
                    and by \cref{corollary:wf-nf}, $[[Γ ⊢ nf(iQ)]]$;
                \item $[[Γ; Φ ⊨ v : iP]]$, 
                    which by the induction hypothesis implies
                    $[[Γ ⊢ iP]]$ and $[[Γ; Φ ⊢ v : iP]]$;
                \item $[[Γ ; · ⊨ uQ ≥ iP ⫤ ·]]$,
                    which by \cref{lemma:pos-subt-soundness} implies
                    $[[Γ ⊢ [·]uQ ≥ iP]]$, that is $[[Γ ⊢ iQ ≥ iP]]$.
            \end{enumerate}

            To infer 
            $[[Γ; Φ ⊢ (v : iQ) : iQ]]$, 
            we apply \ruleref{\ottdruleDTPAnnotLabel} 
            to $[[Γ; Φ ⊢ v : iP]]$ and $[[Γ ⊢ iQ ≥ iP]]$.
            Then by \ruleref{\ottdruleDTPEquivLabel},
            $[[Γ; Φ ⊢ (v : iQ) : nf(iQ)]]$.
  
        \item \ruleref{\ottdruleATNAnnotLabel}
            The proof is symmetric to the previous case
            (\cref{case:typing-soundness:pos-annot}).

        \item \ruleref{\ottdruleATtLamLabel}
            We are proving that if 
            $[[Γ; Φ ⊨ λx:iP . c : nf(iP → iN)]]$
            then 
            $[[Γ ⊢ nf(iP → iN)]]$ and
            $[[Γ; Φ ⊢ λx:iP . c : nf(iP → iN)]]$.


            By inversion of $[[Γ; Φ ⊨ λx:iP . c : nf(iP → iN)]]$,
            we have $[[Γ ⊢ λx:iP . c]]$, 
            which implies $[[Γ ⊢ iP]]$.

            Also by inversion of $[[Γ; Φ ⊨ λx:iP . c : nf(iP → iN)]]$,
            we have $[[Γ; Φ, x:iP ⊨ c : iN]]$, applying induction 
            hypothesis to which gives us:
            \begin{enumerate}
                \item  $[[Γ ⊢ iN]]$, thus $[[Γ ⊢ iP → iN]]$, 
                    and by \cref{corollary:wf-nf}, $[[Γ ⊢ nf(iP → iN)]]$;
                \item $[[Γ; Φ, x:iP ⊢ c : iN]]$, 
                    which by \ruleref{\ottdruleDTtLamLabel} implies
                    $[[Γ; Φ ⊢ λx:iP . c : iP → iN]]$, 
                    and by \ruleref{\ottdruleDTPEquivLabel},
                    $[[Γ; Φ ⊢ λx:iP . c : nf(iP → iN)]]$.
            \end{enumerate}

        \item \ruleref{\ottdruleATTLamLabel}
            We are proving that if
            $[[Γ; Φ ⊨ Λα⁺ . c : nf(∀α⁺.iN)]]$
            then 
            $[[Γ ; Φ ⊢ Λα⁺ . c : nf(∀α⁺.iN)]]$
            and
            $[[Γ ⊢ nf(∀α⁺.iN)]]$.

            
            By inversion of $[[Γ, α⁺ ; Φ ⊨ c : iN]]$,
            we have $[[Γ ⊢ Λα⁺ . c]]$, which implies $[[Γ, α⁺ ⊢ c]]$.

            Also by inversion of 
            $[[Γ, α⁺ ; Φ ⊨ c : iN]]$, 
            we have $[[Γ, α⁺ ; Φ ⊨ c : iN]]$. 
            Obtaining the induction hypothesis to $[[Γ, α⁺ ; Φ ⊨ c : iN]]$,
            we have:
            \begin{enumerate}
                \item $[[Γ, α⁺ ⊢ iN]]$, thus $[[Γ ⊢ ∀α⁺.iN]]$,
                    and by \cref{corollary:wf-nf}, $[[Γ ⊢ nf(∀α⁺.iN)]]$;
                \item $[[Γ, α⁺ ; Φ ⊢ c : iN]]$, 
                    which by \ruleref{\ottdruleDTTLamLabel} implies
                    $[[Γ ; Φ ⊢ Λα⁺ . c : ∀α⁺.iN]]$, 
                    and by \ruleref{\ottdruleDTPEquivLabel},
                    $[[Γ ; Φ ⊢ Λα⁺ . c : nf(∀α⁺.iN)]]$.
            \end{enumerate}
            
        \item \ruleref{\ottdruleATVarLetLabel}
            We are proving that if
            $[[Γ; Φ ⊨ let x = v ; c : iN]]$
            then
            $[[Γ ; Φ ⊢ let x = v ; c : iN]]$ and 
            $[[Γ ⊢ iN]]$.


            By inversion of 
            $[[Γ; Φ ⊨ let x = v ; c : iN]]$,
            we have:
            \begin{enumerate}
                \item $[[Γ ⊢ let x = v ; c]]$, which gives us 
            $[[Γ ⊢ v]]$ and $[[Γ ⊢ c]]$.
                \item $[[Γ; Φ ⊨ v : iP]]$, 
                    which by the induction hypothesis implies
                    $[[Γ ⊢ iP]]$ (and thus, $[[Γ ⊢ Φ, x:iP]]$) 
                    and $[[Γ; Φ ⊢ v : iP]]$; 
                \item $[[Γ; Φ, x:iP ⊨ c : iN]]$, 
                    which by the induction hypothesis implies
                    $[[Γ ⊢ iN]]$ and $[[Γ; Φ, x:iP ⊢ c : iN]]$.
            \end{enumerate}
            This way, 
            $[[Γ; Φ ⊢ let x = v ; c : iN]]$ holds by
            \ruleref{\ottdruleDTVarLetLabel}.

        \item \ruleref{\ottdruleATAppLetAnnLabel}
            We are proving that 
            $[[Γ; Φ ⊨ let x:iP = v(args); c' : iN]]$
            then 
            $[[Γ ; Φ ⊢ let x:iP = v(args); c' : iN]]$ and
            $[[Γ ⊢ iN]]$.

            By inversion, we have:
            \begin{enumerate}
                \item $[[Γ ⊢ iP]]$, hence, $[[Γ ⊢ Φ, x:iP]]$
                \item $[[Γ; Φ ⊨ v : ↓iM]]$
                \item $[[Γ; Φ; · ⊨ uM ● args ⇒> ↑uQ ⫤ Θ; SC1]]$
                \item $[[Γ; Θ ⊨ ↑uQ ≤ ↑iP ⫤ SC2]]$
                \item $[[Θ ⊢ SC1 & SC2 = SC]]$
                \item $[[Γ; Φ, x:iP ⊨ c' : iN]]$
            \end{enumerate}

            By the soundness of constraint merge (\cref{lemma:merge-soundness}), 
            we have $[[Θ ⊢ SC]]$. Let us take $[[uσ]]$ such that $[[Θ ⊢ uσ : SC]]$
            (it exists by \cref{lemma:substitution-existence}). 
            Notice that by the soundness of constraint merge, 
            $[[Θ ⊢ uσ : SC1]]$ and $[[Θ ⊢ uσ : SC2]]$.

            By the induction hypothesis applied to $[[Γ; Φ ⊨ v : ↓iM]]$, we have
            $[[Γ; Φ ⊢ v : ↓iM]]$ and $[[Γ ⊢ ↓iM]]$ (and hence, $[[Γ ; Θ ⊢ uM]]$).

            By the induction hypothesis applied to $[[Γ; Φ, x:iP ⊨ c' : iN]]$, we have
            $[[Γ; Φ, x:iP ⊢ c' : iN]]$ and $[[Γ ⊢ iN]]$. 

            By the induction hypothesis applied to $[[Γ; Φ; · ⊨ uM ● args ⇒> ↑uQ ⫤ Θ; SC1]]$, we have:
            \begin{enumerate}
                \item \label{typing-soundness:theta-wf} $[[Γ ⊢ Θ]]$,
                \item $[[Γ; Θ ⊢ ↑uQ]]$,
                \item $[[Θ' ⊢ SC1]]$,
                \item for any $[[Θ' ⊢ uσ : SC1]]$, we have $[[ Γ ; Φ ⊢ [uσ]uM ● args ⇒> [uσ]↑uQ ]]$.
                In particular, it holds for the $[[uσ]]$ chosen above. 
            \end{enumerate}

            By the soundness of negative subtyping (\cref{lemma:neg-subtyping-soundness})
            applied to $[[Γ; Θ ⊨ ↑uQ ≤ ↑iP ⫤ SC]]$, we have $[[Γ ⊢ ↑[uσ]uQ ≤ ↑iP]]$.

            To infer $[[Γ ; Φ ⊢ let x : iP = v(args); c' : iN ]]$,
            we apply the corresponding declarative rule \ruleref{\ottdruleDTAppLetAnnLabel}, where
            $[[iQ]]$ is $[[ [uσ]uQ  ]]$. Notice that all the premises were already shown to
            hold above:
            \begin{enumerate}
                \item $[[Γ ⊢ iP]]$ and $[[Γ; Φ ⊢ v : ↓iM]]$ from the assumption,
                \item $[[Γ; Φ ⊢ iM ● args ⇒> ↑[uσ]uQ]]$ holds since $[[ [uσ]↑uQ ]] = [[ ↑[uσ]uQ ]]$,
                \item $[[Γ ⊢ ↑[uσ]uQ ≤ ↑iP]]$ by the soundness of negative subtyping,
                \item $[[Γ; Φ, x:iP ⊢ c' : iN]]$ from the the induction hypothesis.
            \end{enumerate}

        \item \ruleref{\ottdruleATAppLetLabel}
            We are proving that if
            $[[Γ; Φ ⊨ let x = v(args); c' : iN]]$
            then
            $[[Γ ; Φ ⊢ let x = v(args); c' : iN]]$ and
            $[[Γ ⊢ iN]]$.

            By the inversion, we have:
            \begin{enumerate}
                \item $[[Γ; Φ ⊨ v : ↓iM]]$ 
                \item $[[Γ ; Φ ; · ⊨ uM ● args ⇒> ↑uQ ⫤ Θ; SC]]$
                \item $[[uv uQ ⊆ dom(SC)]]$
                \item $[[SC|uv(uQ) singular with uσ3]]$
                \item $[[Γ; Φ, x:[uσ3]uQ ⊨ c' : iN]]$
            \end{enumerate}

            By the induction hypothesis applied to $[[Γ; Φ ⊨ v : ↓iM]]$, we have    
            $[[Γ; Φ ⊢ v : ↓iM]]$ and $[[Γ ⊢ ↓iM]]$ (and thus, $[[Γ ; Θ  ⊢ uM]]$).
       
            By the induction hypothesis applied to $[[Γ; Φ, x:[uσ3]uQ ⊨ c' : iN]]$, we have
            $[[Γ ⊢ iN]]$ and $[[Γ; Φ, x:[uσ3]uQ ⊢ c' : iN]]$.

            By the induction hypothesis applied to 
            $[[Γ ; Φ ; · ⊨ uM ● args ⇒> ↑uQ ⫤ Θ; SC]]$, we have:
            \begin{enumerate}
                \item $[[Γ ⊢ Θ]]$
                \item $[[Γ; Θ ⊢ ↑uQ]]$
                \item $[[Θ ⊢ SC]]$
                \item for any $[[Θ ⊢ uσ : SC]]$, we have $[[ Γ ; Φ ⊢ [uσ]uM ● args ⇒> [uσ]↑uQ ]]$, 
                    which, since  $[[iM]]$ is ground means $[[ Γ ; Φ ⊢ iM ● args ⇒> ↑[uσ]uQ]]$.
            \end{enumerate}

            To infer $[[Γ ; Φ ⊢ let x = v(args) ; c' : iN ]]$, 
            we apply the corresponding 
            declarative rule \ruleref{\ottdruleDTAppLetLabel}.
            Let us show that the premises hold:
            \begin{itemize}
                \item $[[Γ; Φ ⊢ v : ↓iM]]$ holds by the induction hypothesis;
                \item $[[Γ; Φ, x:[uσ3]uQ ⊢ c' : iN]]$ also holds by the induction hypothesis, as noted above;
                \item Let us take an arbitrary substitution $[[uσ]]$ 
                    satisfying $[[Θ ⊢ uσ : SC]]$ (it exists by \cref{lemma:constraint-sat}).
                    Then $[[Γ; Φ ⊢ iM ● args ⇒> ↑[uσ]uQ ]]$ holds, as noted above;
                \item To show the uniqueness of $[[↑[uσ]uQ]]$,
                    we assume that for some other type $[[iK]]$ 
                    holds $[[Γ; Φ ⊢ iM ● args ⇒> iK ]]$,
                    that is $[[Γ; Φ ⊢ [·]uM ● args ⇒> iK ]]$.
                    Then by the completeness of typing 
                    (\cref{lemma:typing-completeness}),
                    there exist $[[uN']]$, $[[Θ']]$, and $[[SC']]$ such that
                    \begin{enumerate}
                        \item $[[ Γ; Φ; · ⊨ uM ● args ⇒> uN' ⫤ Θ'; SC' ]]$ and
                        \item there exists a substitution $[[Θ' ⊢ uσ' : SC']]$ such that
                            $[[Γ ⊢ [uσ']uN' ≈ iK]]$.
                    \end{enumerate}
                    By the determinicity of the typing algorithm (\cref{lemma:typing-determinicity}),
                    $[[ Γ; Φ; · ⊨ uM ● args ⇒> uN' ⫤ Θ'; SC' ]]$,
                    means that $[[SC']]$ is $[[SC]]$, $[[Θ']]$ is $[[Θ]]$, and $[[uN']]$ is
                    $[[↑uQ]]$. 
                    This way, $[[Γ ⊢ [uσ']↑uQ ≈ iK]]$ for a substitution 
                    $[[Θ ⊢ uσ' : SC]]$. 

                    It is left to show that $[[Γ ⊢ [uσ']↑uQ ≈ [uσ]↑uQ]]$, 
                    then by transitivity of the equivalence, we will have $[[Γ ⊢ [uσ]↑uQ ≈ iK]]$.
                    Since $[[Θ ⊢ uσ : SC|uv(uQ)]]$ and $[[Θ ⊢ uσ' : SC|uv(uQ)]]$, 
                    and $[[SC|uv(uQ) singular with uσ3]]$, we have 
                    $[[Θ ⊢ uσ ≈ uσ3 : dom(SC|uv(uQ))]]$
                    and $[[Θ ⊢ uσ' ≈ uσ3 : dom(SC|uv(uQ))]]$.
                    Then since $[[uv(uQ) ⊆ dom(SC)]]$, we have $[[dom(SC|uv(uQ)) = uv(uQ)]]$.
                    This way, by transitivity and symmetry of the equivalence, 
                    $[[Θ ⊢ uσ ≈ uσ' : uv(uQ)]]$, which implies
                    $[[Γ ⊢ [uσ']↑uQ ≈ [uσ]↑uQ]]$. 
            \end{itemize}

        \item \ruleref{\ottdruleATUnpackLabel}
            We are proving that if 
            $[[Γ; Φ ⊨ let∃ (nas, x) = v; c' : iN]]$
            then
            $[[Γ ; Φ ⊢ let∃ (nas, x) = v; c' : iN]]$ and
            $[[Γ ⊢ iN]]$.
            By the inversion, we have:
            \begin{enumerate}
                \item $[[Γ; Φ ⊨ v : ∃nas.iP]]$
                \item $[[Γ, nas ; Φ, x:iP ⊨ c' : iN]]$
                \item $[[Γ ⊢ iN]]$
            \end{enumerate}

            By the induction hypothesis applied to 
            $[[Γ; Φ ⊨ v : ∃nas.iP]]$, we have $[[Γ; Φ ⊢ v : ∃nas.iP]]$
            and $[[∃nas.iP]]$ is normalized.
            By the induction hypothesis applied to
            $[[Γ, nas ; Φ, x:iP ⊨ c' : iN]]$, we have $[[Γ, nas ; Φ, x:iP ⊢ c' : iN]]$.

            To show $[[Γ; Φ ⊢ let∃ (nas, x) = v; c' : iN]]$, we apply the corresponding
            declarative rule \ruleref{\ottdruleDTUnpackLabel}. Let us show that the premises hold:
            \begin{enumerate}
                \item $[[Γ ; Φ ⊢ v : ∃nas.iP]]$ holds by the induction hypothesis, as noted above,
                \item $[[nf(∃nas.iP) = ∃nas.iP]]$ holds since $[[∃nas.iP]]$ is normalized,
                \item $[[Γ, nas ; Φ, x:iP ⊢ c' : iN]]$ also holds by the induction hypothesis,
                \item $[[Γ ⊢ iN]]$ holds by the inversion, as noted above.
            \end{enumerate}

        \item \ruleref{\ottdruleATEmptyAppLabel}
            Then by assumption:
            \begin{itemize}
                \item $[[Γ ⊢ Θ]]$,
                \item $[[Γ; Θ ⊢ uN]]$ is free from negative metavariables,
                \item $[[Γ; Φ; Θ ⊨ uN ● · ⇒> nf(uN) ⫤ Θ; ·]]$.
            \end{itemize}

            Let us show the required properties: 
            \begin{enumerate}
                \item $[[Γ ⊢ Θ]]$ holds by assumption,
                \item $[[Θ]] \subseteq [[Θ]]$ holds trivially,
                \item $[[nf(uN)]]$ is evidently normalized, 
                    $[[Γ; Θ ⊢ uN]]$ implies $[[Γ; Θ ⊢ nf(uN)]]$ by 
                    \cref{corollary:wf-nf},
                    and \cref{lemma:fv-nf} means that $[[nf(uN)]]$ is 
                    inherently free from negative metavariables,
                \item $[[Θ ⊢ ·]]$ holds trivially,
                \item for any $[[Θ ⊢ uσ : ·]]$, we have $[[ Γ ; Φ ⊢ [uσ]uN ● · ⇒> [uσ]uN ]]$.
                    To show $[[ Γ ; Φ ⊢ [uσ]uN ● · ⇒> [uσ]nf(uN) ]]$, we apply the corresponding 
                    declarative rule \ruleref{\ottdruleDTEmptyAppLabel}.
                    $[[ Γ ⊢ [uσ]uN ≈ [uσ]nf(uN) ]]$ holds 
                    by \cref{corollary:subst-pres-equiv},
                    since $[[ Γ ⊢ uN ≈ nf(uN) ]]$ by 
                    \cref{corollary:nf-sound-wrt-subt-equiv}.
            \end{enumerate}

        \item \ruleref{\ottdruleATArrowAppLabel} 
            By assumption:
            \begin{enumerate}
                \item $[[Γ ⊢ Θ]]$,
                \item $[[Γ; Θ ⊢ uQ → uN]]$ is free from negative metavariables,
                    and hence, so are $[[uQ]]$ and $[[uN]]$,
                \item $[[Γ; Φ; Θ ⊨ uQ → uN ● v , args ⇒> uM ⫤ Θ'; SC]]$, 
                    and by inversion: 
                    \begin{enumerate}
                        \item $[[Γ; Φ ⊨ v : iP]]$,
                            and by the induction hypothesis applied to this judgment,
                            we have $[[Γ; Φ ⊢ v : iP]]$, and $[[Γ ⊢ iP]]$;
                        \item $[[Γ; Θ ⊨ uQ ≥ iP ⫤ SC1]]$,
                            and by the soundness of subtyping:
                            $[[Θ ⊢ SC]]$ and
                            for any $[[Θ ⊢ uσ : SC1]]$, we have $[[Γ ⊢ [uσ]uQ ≥ iP]]$;
                        \item $[[Γ; Φ; Θ ⊨ uN ● args ⇒> uM ⫤ Θ'; SC2]]$,
                            and by the induction hypothesis applied to this judgment,
                            \begin{enumerate}
                                \item $[[Γ ⊢ Θ']]$,
                                \item $[[Θ ⊆ Θ']]$,
                                \item $[[Γ; Θ' ⊢ uM]]$ is normalized and free from negative metavariables,
                                \item $[[Θ' ⊢ SC2]]$,
                                \item for any $[[Θ' ⊢ uσ : SC2]]$, we have 
                                    $[[ Γ ; Φ ⊢ [uσ]uN ● args ⇒> [uσ]uM ]]$;
                            \end{enumerate}
                        \item $[[Θ ⊢ SC1 & SC2 = SC]]$.
                    \end{enumerate}
            \end{enumerate}

            Let us show the required properties:
            \begin{enumerate}
                \item $[[Γ ⊢ Θ']]$ is shown above,
                \item $[[Θ ⊆ Θ']]$ is shown above,
                \item $[[Γ; Θ' ⊢ uM]]$ is normalized and free from negative metavariables, as shown above,
                \item $[[Θ' ⊢ SC]]$ holds:  
                $[[Θ ⊢ SC1]]$ and $[[Θ ⊆ Θ']]$ imply $[[Θ' ⊢ SC1]]$,
                then we apply the soundness of constraint merge (\cref{lemma:merge-soundness})
                to $[[Θ' ⊢ SC1 & SC2]]$:
                \begin{enumerate}
                    \item $[[Θ' ⊢ SC1]]$,
                    \item for any $[[Θ' ⊢ uσ : SC]]$, $[[Θ' ⊢ uσ : SCi]]$ holds;
                \end{enumerate}
                \item suppose that $[[Θ' ⊢ uσ : SC]]$. Then to 
                    show $[[ Γ ; Φ ⊢ [uσ](uQ → uN) ● v , args ⇒> [uσ]uM ]]$, 
                    that is $[[ Γ ; Φ ⊢ [uσ]uQ → [uσ]uN ● v , args ⇒> [uσ]uM ]]$,
                    we apply the corresponding declarative rule \ruleref{\ottdruleDTArrowAppLabel}.
                    Let us show the required premises:
                    \begin{enumerate}
                        \item $[[Γ; Φ ⊢ v : iP]]$ holds as shown above,
                        \item $[[Γ ⊢ [uσ]uQ ≥ iP]]$ holds by the soundness of subtyping 
                            as noted above,
                            since $[[Θ' ⊢ uσ : SC]]$ implies $[[Θ ⊢ uσ : SC1]]$.
                        \item $[[Γ; Φ ⊢ [uσ]uN ● args ⇒> [uσ]uM]]$ holds by the induction hypothesis
                            as shown above,
                            since $[[Θ' ⊢ uσ : SC]]$ implies $[[Θ' ⊢ uσ : SC2]]$.
                    \end{enumerate}
            \end{enumerate}
        \item \ruleref{\ottdruleATForallAppLabel}\\
            By assumption:
            \begin{enumerate}
                \item $[[Γ ⊢ Θ]]$,
                \item $[[Γ; Θ ⊢ ∀pas.uN]]$ is free from negative metavariables,
                \item $[[Γ; Φ; Θ ⊨ ∀pas.uN ● args ⇒> uM ⫤ Θ'; SC]]$, which by inversion means
                    $[[args ≠ ·]]$, $[[pas ≠ ·]]$, and $[[Γ; Φ; Θ, â⁺*[Γ] ⊨ [â⁺*/pas]uN ● args ⇒> uM ⫤ Θ'; SC]]$.
                    It is easy to see that the induction hypothesis is applicable to the latter judgment:
                    \begin{itemize}
                        \item $[[Γ ⊢ Θ, â⁺*[Γ] ]]$ holds by $[[Γ ⊢ Θ]]$, 
                        \item $[[Γ; Θ, â⁺*[Γ] ⊢ [â⁺*/pas]uN]]$
                            holds since $[[Γ; Θ ⊢ ∀pas.uN]]$.
                            $[[ [â⁺*/pas]uN ]]$ is normalized and free from negative metavariables
                            since so is $[[uN]]$;
                    \end{itemize}
                    This way, by the inductive hypothesis applied to 
                    $[[Γ; Φ; Θ, â⁺*[Γ] ⊨ [â⁺*/pas]uN ● args ⇒> uM ⫤ Θ'; SC]]$,
                    we have:
                    \begin{enumerate}
                        \item $[[Γ ⊢ Θ']]$,
                        \item $[[Θ, â⁺*[Γ] ⊆ Θ']]$,
                        \item $[[Γ; Θ' ⊢ uM]]$ is normalized and free from negative metavariables,
                        \item $[[Θ' ⊢ SC]]$,
                        \item for any $[[Θ' ⊢ uσ : SC]]$, we have $[[ Γ ; Φ ⊢ [uσ][â⁺*/pas]uN ● args ⇒> [uσ]uM ]]$.
                    \end{enumerate}
            \end{enumerate}

            Let us show the required properties:
            \begin{enumerate}
                \item $[[Γ ⊢ Θ']]$ is shown above;
                \item $[[Θ ⊆ Θ']]$ since $[[Θ, â⁺*[Γ] ⊆ Θ']]$;
                \item $[[Γ; Θ' ⊢ uM]]$ is normalized and free from negative metavariables, as shown above;
                \item $[[Θ' ⊢ SC]]$ is shown above;
                \item let us assume $[[Θ' ⊢ uσ : SC]]$.
                    Then to show $[[ Γ ; Φ ⊢ [uσ]∀pas.uN ● args ⇒> [uσ]uM ]]$,
                    we apply the corresponding declarative rule \ruleref{\ottdruleDTForallAppLabel}
                    with substitution $[[ Γ ⊢ σ : pas ]]$  defined in the following way:
                    $[[ [σ]αi⁺ ]] = [[ [uσ]αî⁺ ]]$.

                    Let us show that the premises of 
                    \ruleref{\ottdruleDTForallAppLabel} hold:
                    \begin{enumerate}
                        \item $[[Γ ⊢ σ : pas]]$, i.e.
                            $[[ Γ ⊢ [σ] αi⁺ ]]$ holds since $[[ Θ' ⊢ uσ ]]$ and $[[Γ ⊢ Θ']]$;
                        \item $[[Γ; Φ ⊢ [σ][uσ]uN ● args ⇒> [uσ]uM ]]$ 
                            holds by rewriting it into
                            $[[ Γ ; Φ ⊢ [uσ][â⁺*/pas]uN ● args ⇒> [uσ]uM ]]$
                            using equality $[[ [uσ][â⁺*/pas]uN = [σ][uσ]uN ]]$:
                            \begin{enumerate}
                                \item for $[[ αi⁺ ]] \in [[ pas ]]$, $[[ [uσ][â⁺*/pas] αi⁺ ]] = [[ [uσ]αî⁺ ]] = [[ [σ]αi⁺ ]] = [[ [σ][uσ]αi⁺ ]]$,
                                \item for $[[ β̂± ]] \in [[ dom(uσ) ]]$, $[[ [uσ][â⁺*/pas]β̂±  ]] = [[ [uσ]β̂±  ]] = [[ [σ][uσ]β̂± ]] $, 
                                    where the latter equality holds since $[[ {pas} ∩ {Γ} = ∅ ]]$.
                                \item $[[args ≠ ·]]$ and $[[pas ≠ ·]]$ hold by assumption.
                            \end{enumerate}
                \end{enumerate}
            \end{enumerate}



    \end{caseof}
\end{proof}


\begin{lemma}[Completeness of Typing]
    \label{lemma:typing-completeness}
    Suppose that $[[Γ ⊢ Φ]]$.
    For an inference tree $T_1$,
    \begin{itemize}
        \item [$+$] If $T_1$ infers $[[Γ; Φ ⊢ v : iP]]$ then $[[Γ; Φ ⊨ v : nf(iP)]]$        
        \item [$-$] If $T_1$ infers $[[Γ; Φ ⊢ c : iN]]$ then  $[[Γ; Φ ⊨ c : nf(iN)]]$
        \item [$\bullet$] Suppose that 
            $T1$ infers $[[Γ; Φ ⊢ [uσ]uN ● args ⇒> iM]]$ for some
            $[[Γ ⊢ Θ]]$,
            $[[Γ; Θ ⊢ uN]]$ (free from negative metavariables, that is $[[α̂⁻]] \notin [[uv uN]]$), 
            $[[Θ ⊢ uσ]]$, and $[[Γ ⊢ iM]]$. Then
            there exist $[[uM']]$, $[[Θ']]$, and $[[SC]]$ such that
            \begin{enumerate}
                \item $[[ Γ; Φ; Θ ⊨ uN ● args ⇒> uM' ⫤ Θ'; SC ]]$ and
                \item for any $[[Θ ⊢ uσ]]$ and $[[Γ ⊢ iM]]$
                    such that $[[Γ; Φ ⊢ [uσ]uN ● args ⇒> iM]]$, 
                    there exists $[[uσ']]$ such that 
                    \begin{enumerate}
                        \item $[[Θ' ⊢ uσ' : SC]]$,
                        \item $[[Θ ⊢ uσ' ≈ uσ : dom(Θ)]]$, and 
                        \item $[[Γ ⊢ [uσ']uM' ≈ iM]]$.
                    \end{enumerate}
            \end{enumerate}
    \end{itemize}
\end{lemma}
\begin{proof}
    We prove it by induction on $\metric{T_1}$, mutually with 
    the soundness of typing (\cref{lemma:typing-soundness}).
    Let us consider the last rule applied to infer the derivation.
    \begin{caseof}

        \item \ruleref{\ottdruleDTThunkLabel}\\
            \label{case:typing-completeness-thunk}
            Then we are proving that if 
            $[[Γ; Φ ⊢ {c} : ↓iN]]$ (inferred by \ruleref{\ottdruleDTThunkLabel})
            then $[[Γ; Φ ⊨ {c} : nf(↓iN)]]$.
            By inversion of $[[Γ; Φ ⊢ {c} : ↓iN]]$, we have
            $[[Γ; Φ ⊢ c : iN]]$, which we apply the induction hypothesis to
            to obtain $[[Γ; Φ ⊨ c : nf(iN)]]$.
            Then by \ruleref{\ottdruleATThunkLabel}, we have $[[Γ; Φ ⊨ {c} : ↓nf(iN)]]$.
            It is left to notice that $[[↓nf(iN) = nf(↓iN)]]$.

        \item \ruleref{\ottdruleDTReturnLabel}\\
            The proof is symmetric to the previous case 
            (\cref{case:typing-completeness-thunk}).

        \item \ruleref{\ottdruleDTPAnnotLabel}\\
            \label{case:typing-completeness-pannot}
            Then we are proving that if
            $[[Γ; Φ ⊢ (v : iQ) : iQ]]$ is inferred by \ruleref{\ottdruleDTPAnnotLabel}
            then $[[Γ; Φ ⊨ (v : iQ) : nf(iQ)]]$.
            By inversion, we have:
            \begin{enumerate}
                \item $[[Γ ⊢ iQ]]$;
                \item $[[Γ; Φ ⊢ v : iP]]$, which
                    by the induction hypothesis implies $[[Γ; Φ ⊨ v : nf(iP)]]$;
                \item $[[Γ ⊢ iQ ≥ iP]]$, and by transitivity, $[[Γ ⊢ iQ ≥ nf(iP)]]$;
                    Since $[[iQ]]$ is ground, 
                    we have $[[Γ ; · ⊢ uQ]]$ and $[[Γ ⊢ [·]uQ ≥ nf(iP)]]$.
                    Then by the completeness of subtyping
                    (\cref{lemma:subtyping-completeness}), we have 
                    $[[Γ ; · ⊨ uQ ≥ nf(iP) ⫤ SC]]$, where $[[· ⊢ SC]]$ 
                    (implying $[[SC]] = [[·]]$).
                    This way, $[[Γ ; · ⊨ uQ ≥ nf(iP) ⫤ ·]]$.
            \end{enumerate}
            Then we can apply \ruleref{\ottdruleATPAnnotLabel} to
            $[[Γ ⊢ iQ]]$, $[[Γ; Φ ⊨ v : nf(iP)]]$ and $[[Γ ; · ⊨ uQ ≥ nf(iP) ⫤ ·]]$
            to infer $[[Γ; Φ ⊨ (v : iQ) : nf(iQ)]]$.

        \item \ruleref{\ottdruleDTNAnnotLabel}\\
            The proof is symmetric to the previous case 
            (\cref{case:typing-completeness-pannot}).

        \item \ruleref{\ottdruleDTtLamLabel}\\
            Then we are proving that if
            $[[Γ ; Φ ⊢ λx:iP . c : iP → iN]]$ is inferred by \ruleref{\ottdruleDTtLamLabel},
            then $[[Γ ; Φ ⊨ λx:iP . c : nf(iP → iN)]]$.

            By inversion of $[[Γ ; Φ ⊢ λx:iP . c : iP → iN]]$, we have
            $[[Γ ⊢ iP]]$ and $[[Γ; Φ, x:iP ⊢ c : iN]]$.
            Then by the induction hypothesis, $[[Γ; Φ, x:iP ⊨ c : nf(iN)]]$.
            By \ruleref{\ottdruleATtLamLabel}, we infer
            $[[Γ; Φ ⊨ λx:iP . c : nf(iP → nf(iN))]]$. 
            By idempotence of normalization (\cref{lemma:norm-idemp}), 
            $[[nf(iP → nf(iN)) = nf(iP → iN)]]$, 
            which concludes the proof for this case.

        \item \ruleref{\ottdruleDTTLamLabel}\\
            Then we are proving that if
            $[[Γ ; Φ ⊢ Λα⁺ . c : ∀α⁺.iN]]$ is inferred by \ruleref{\ottdruleDTTLamLabel},
            then $[[Γ ; Φ ⊨ Λα⁺ . c : nf(∀α⁺.iN)]]$.
            Similar to the previous case, 
            by inversion of $[[Γ ; Φ ⊢ Λα⁺ . c : ∀α⁺.iN]]$, we have
            $[[Γ, α⁺ ; Φ ⊢ c : iN]]$, and then by the induction hypothesis,
            $[[Γ, α⁺ ; Φ ⊨ c : nf(iN)]]$.
            After that, application of \ruleref{\ottdruleATTLamLabel}, 
            gives as $[[Γ ; Φ ⊨ Λα⁺ . c : nf(∀α⁺.nf(iN))]]$.

            It is left to show that $[[nf(∀α⁺.nf(iN)) = nf(∀α⁺.iN)]]$.
            Assume $[[iN = ∀pbs.iM]]$ (where $[[iM]]$ does not start with $\forall$).
            \begin{itemize}
                \item Then by definition, $[[nf(∀α⁺.iN) = nf(∀α⁺,pbs.iM)]] = 
                    [[∀pcs.nf(iM)]]$, where $[[ord {α⁺,pbs} in nf(iM) = pcs]]$.
                \item On the other hand, $[[nf(iN) = ∀pcs'.nf(iM)]]$, 
                    where $[[ord {pbs} in nf(iM) = pcs']]$, and thus, 
                    $[[nf(∀α⁺.nf(iN)) = nf(∀α⁺,pcs'.nf(iM))]] = [[∀pcs''.nf(nf(iM))]]
                    = [[∀pcs''.nf(iM)]]$,
                    where $[[ord {α⁺,pcs'} in nf(nf(iM)) = pcs'']]$. 
            \end{itemize}
            It is left to show that $[[pcs'' = pcs]]$.
            $$ 
            \begin{aligned}[t] 
                [[ pcs'' ]] &= [[ord {α⁺,pcs'} in nf(nf(iM))]] \\
                            &= [[ord {α⁺,pcs'} in nf(iM)]]
                            && \text{by idempotence (\cref{lemma:norm-idemp})}\\
                            &= [[ord {α⁺} ∪ {pbs} ∩ fv nf(iM) in nf(iM)]]
                            && \text{by definition of $[[pcs']]$ and \cref{lemma:ord-soundness}}\\
                            &= [[ord ({α⁺} ∪ {pbs} ∩ fv nf(iM)) ∩ fv nf(iM) in nf(iM)]]
                            && \text{by \cref{corollary:ord-weakening}}\\
                            &= [[ord ({α⁺} ∪ {pbs}) ∩ fv nf(iM) in nf(iM)]]
                            && \text{by set properties}\\
                            &= [[ord {α⁺,pbs} in nf(iM)]]\\
                            &= [[pcs]]
                \end{aligned} 
            $$

        \item \ruleref{\ottdruleDTUnpackLabel}\\
            Then we are proving that if
            $[[Γ ; Φ ⊢ let∃ (nas, x) = v; c : iN]]$ is 
            inferred by \ruleref{\ottdruleDTUnpackLabel},
            then $[[Γ ; Φ ⊨ let∃ (nas, x) = v; c : nf(iN)]]$.

            By inversion of $[[Γ ; Φ ⊢ let∃ (nas, x) = v; c : iN]]$, we have
            \begin{enumerate}
                \item $[[nf(∃nas.iP) = ∃nas.iP]]$,
                \item $[[Γ ; Φ ⊢ v : ∃nas.iP]]$, 
                    which by the induction hypothesis implies 
                    $[[Γ ; Φ ⊨ v : nf(∃nas.iP)]]$, 
                    and hence, $[[Γ ; Φ ⊨ v : ∃nas.iP]]$.
                \item $[[Γ, nas ; Φ, x:iP ⊢ c : iN]]$,
                    and by the induction hypothesis, 
                    $[[Γ, nas ; Φ, x:iP ⊨ c : nf(iN)]]$.
                \item $[[Γ ⊢ iN]]$.
            \end{enumerate}
            
            This way, we can apply \ruleref{\ottdruleATUnpackLabel} to
            infer $[[Γ ; Φ ⊨ let∃ (nas, x) = v; c : nf(iN)]]$.

        \item \ruleref{\ottdruleDTPEquivLabel}\\
            Then we are proving that
            if $[[Γ; Φ ⊢ v : iP']]$ is inferred by \ruleref{\ottdruleDTPEquivLabel},
            then $[[Γ; Φ ⊨ v : nf(iP')]]$.
            By inversion, $[[Γ ; Φ ⊢ v : iP]]$ and $[[Γ ⊢ iP ≈ iP']]$,
            and the metric of the tree inferring $[[Γ ; Φ ⊢ v : iP]]$ is less than the one 
            inferring $[[Γ; Φ ⊢ v : iP']]$.
            Then by the induction hypothesis, $[[Γ; Φ ⊨ v : nf(iP)]]$.

            By \cref{lemma:subt-equiv-algorithmization}
            $[[Γ ⊢ iP ≈ iP']]$ implies $[[nf(iP) = nf(iP')]]$, and thus, 
            $[[Γ; Φ ⊨ v : nf(iP)]]$ can be rewritten to $[[Γ; Φ ⊨ v : nf(iP')]]$.

        \item \ruleref{\ottdruleDTVarLabel}\\
            Then we are proving that
            $[[Γ; Φ ⊢ x : iP]]$
            implies
            $[[Γ; Φ ⊨ x : nf(iP)]]$.
            By inversion of $[[Γ; Φ ⊢ x : iP]]$,
            we have $[[x : iP ∊ Φ ]]$.
            Then \ruleref{\ottdruleATVarLabel} applies to infer
            $[[Γ; Φ ⊨ x : nf(iP)]]$.

        \item \ruleref{\ottdruleDTVarLetLabel}\\
            Then we are proving that
            $[[Γ; Φ ⊢ let x = v(args); c : iN]]$
            implies
            $[[Γ; Φ ⊨ let x = v(args); c : nf(iN)]]$.

            By inversion of
            $[[Γ; Φ ⊢ let x = v(args); c : iN]]$,
            we have
            \begin{enumerate}
                \item $[[Γ; Φ ⊢ v : iP]]$, 
                    and by the induction hypothesis,
                    $[[Γ; Φ ⊨ v : nf(iP)]]$.
                \item $[[Γ; Φ, x:iP ⊢ c : iN]]$,
                    and by \cref{lemma:decl-typing-context-equiv},
                    since $[[Γ ⊢ iP ≈ nf(iP)]]$, we have
                    $[[Γ; Φ, x:nf(iP) ⊢ c : iN]]$.
                    Then by the induction hypothesis, 
                    $[[Γ; Φ, x:nf(iP) ⊨ c : nf(iN)]]$.
            \end{enumerate}

            Together, $[[Γ; Φ ⊨ v : nf(iP)]]$ and $[[Γ; Φ, x:nf(iP) ⊨ c : nf(iN)]]$
            imply $[[Γ; Φ ⊨ let x = v(args); c : nf(iN)]]$ by \ruleref{\ottdruleATVarLetLabel}.

        \item \ruleref{\ottdruleDTAppLetAnnLabel}\\
            Then we are proving that 
            $[[Γ ; Φ ⊢ let x:iP = v(args); c : iN]]$
            implies 
            $[[Γ; Φ ⊨ let x:iP = v(args); c : nf(iN)]]$.

            By inversion of 
            $[[Γ ; Φ ⊢ let x:iP = v(args); c : iN]]$,
            we have
            \begin{enumerate}
                \item $[[Γ ⊢ iP]]$
                \item $[[Γ ; Φ ⊢ v : ↓iM]]$ for some ground $[[iM]]$,
                    which by the induction hypothesis means
                    $[[Γ ; Φ ⊨ v : ↓nf(iM)]]$
                \item $[[Γ ; Φ ⊢ iM ● args ⇒> ↑iQ]]$. 
                    By \cref{lemma:app-inf-equ-stable}, since
                    $[[Γ ⊢ iM ≈ nf(iM)]]$, we have
                    $[[Γ ; Φ ⊢ [·]nf(uM) ● args ⇒> ↑iQ]]$, 
                    which by the induction hypothesis means 
                    that there exist normalized 
                    $[[uM']]$, $[[Θ]]$, and $[[SC1]]$ such that
                    (noting that $[[iM]]$ is ground):
                    \begin{enumerate}
                        \item $[[ Γ; Φ; · ⊨ nf(uM) ● args ⇒> uM' ⫤ Θ; SC1 ]]$,
                            where by the soundness, $[[Γ; Θ ⊢ uM']]$ and $[[Θ ⊢ SC1]]$.
                        \item for any $[[Γ ⊢ iM'']]$ 
                            such that $[[Γ; Φ ⊢ nf(iM) ● args ⇒> iM'']]$
                            there exists $[[uσ]]$ such that 
                            \begin{enumerate}
                                \item $[[Θ ⊢ uσ : SC1]]$, and 
                                \item $[[Γ ⊢ [uσ]uM' ≈ iM'']]$,
                            \end{enumerate}
                            In particular, there exists
                            $[[Θ ⊢ uσ0 : SC1]]$ such that $[[Γ ⊢ [uσ0]uM' ≈ ↑iQ]]$.
                           Moreover, since $uM'$ is normalized and free of negative metavariables,
                            $[[uM' = ↑uQ0]]$, and $[[Γ ⊢ [uσ0]uQ0 ≈ iQ]]$.
                    \end{enumerate}
                \item $[[Γ ⊢ ↑iQ ≤ ↑iP]]$,
                    and by transitivity, since $[[Γ ⊢ [uσ0]↑uQ0 ≈ ↑iQ]]$,
                    we have $[[Γ ⊢ [uσ0]↑uQ0 ≤ ↑iP]]$.
                    
                    Let us apply \cref{lemma:neg-subt-completeness} to 
                    $[[Γ ⊢ [uσ0]↑uQ0  ≤ ↑iP]]$ and obtain
                    $[[Θ ⊢ SC2]]$ such that 
                    \begin{enumerate}
                        \item $[[Γ ; Θ ⊨ ↑uQ0 ≤ ↑iP ⫤ SC2]]$ and
                        \item $[[Θ ⊢ uσ0 : SC2]]$.
                    \end{enumerate}
                \item $[[Γ; Φ, x:iP ⊢ c : iN]]$, 
                    and by the induction hypothesis,
                    $[[Γ; Φ, x:iP ⊨ c : nf(iN)]]$.
            \end{enumerate}

            To infer $[[Γ; Φ ⊨ let x:iP = v(args); c : nf(iN)]]$,
            we apply the corresponding algorithmic rule 
            \ruleref{\ottdruleATAppLetAnnLabel}.
            Let us show that the premises hold:
            \begin{enumerate}
                \item $[[Γ ⊢ iP]]$,
                \item $[[Γ; Φ ⊨ v : ↓nf(iM)]]$,
                \item $[[Γ; Φ; · ⊨ nf(uM) ● args ⇒> ↑uQ0 ⫤ Θ; SC1]]$, 
                \item $[[Γ; Θ ⊨ ↑uQ0 ≤ ↑iP ⫤ SC2]]$, and
                \item $[[Γ; Φ, x:iP ⊨ c : nf(iN)]]$ hold as noted above;
                \item $[[Θ ⊢ SC1 & SC2 = SC]]$ 
                    is defined by \cref{lemma:merge-completeness},
                    since $[[Θ ⊢ uσ0 : SC1]]$ and $[[Θ ⊢ uσ0 : SC2]]$.
            \end{enumerate}

        \item \ruleref{\ottdruleDTAppLetLabel}\\
            By assumption, $[[c]]$ is $[[let x = v(args); c']]$. 
            Then by inversion of
            $[[Γ ; Φ ⊢ let x = v(args); c' : iN]]$: 
            \begin{itemize}
                \item $[[Γ ; Φ ⊢ v : ↓iM]]$, 
                    which by the induction hypothesis means 
                    $[[Γ; Φ ⊨ v : ↓nf(iM)]]$;
                \item $[[Γ ; Φ ⊢ iM ● args ⇒> ↑iQ uniq]]$. 
                    Then by \cref{lemma:app-inf-equ-stable}, since 
                    $[[Γ ⊢ iM ≈ nf(iM)]]$, we have
                    $[[Γ ; Φ ⊢ nf(iM) ● args ⇒> ↑iQ]]$
                    and moreover, $[[Γ ; Φ ⊢ nf(iM) ● args ⇒> ↑iQ uniq]]$
                    (since symmetrically, $[[nf(iM)]]$ can be replaced back by $[[iM]]$).
                    Then the induction hypothesis applied to 
                    $[[Γ ; Φ ⊢ [·]nf(uM) ● args ⇒> ↑iQ]]$
                    implies that there exist $[[uM']]$, $[[Θ]]$, and $[[SC]]$ such that
                    (considering $[[iM]]$ is ground):
                    \begin{enumerate}
                        \item $[[ Γ; Φ; · ⊨ nf(uM) ● args ⇒> uM' ⫤ Θ; SC ]]$, 
                            which, by the soundness, implies, in particular
                            that 
                            \begin{enumerate}
                                \item $[[uM']]$ is normalized and 
                                    free of negative metavariables, 
                                \item \label{point:typing-completeness:AppLet:ih-sound} 
                                    for any $[[Θ ⊢ uσ : SC]]$, 
                                    we have $[[ Γ ; Φ ⊢ nf(iM) ● args ⇒> [uσ]uM' ]]$,
                                    which, since $[[Γ ; Φ ⊢ nf(iM) ● args ⇒> ↑iQ uniq]]$,
                                    means $[[Γ ⊢ [uσ]uM' ≈ ↑iQ]]$.
                            \end{enumerate}
                            and
                        \item for any $[[Γ ⊢ iM'']]$
                            such that $[[Γ; Φ ⊢ nf(iM) ● args ⇒> iM'']]$,
                            (and in particular, for $[[Γ ⊢ ↑iQ]]$)
                            there exists $[[uσ1]]$ such that 
                            \begin{enumerate}
                                \item $[[Θ ⊢ uσ1 : SC]]$, and 
                                \item $[[Γ ⊢ [uσ1]uM' ≈ iM'']]$, and 
                                in particular, $[[Γ ⊢ [uσ1]uM' ≈ ↑iQ]]$.
                                Since $[[uM']]$ is
                                normalized and free of 
                                negative metavariables, it means that 
                                $[[uM' = ↑uP]]$ for some $[[uP]]$, 
                                that is $[[Γ ⊢ [uσ1]uP ≈ iQ]]$.
                            \end{enumerate}
                    \end{enumerate}
                \item $[[Γ; Φ, x:iQ ⊢ c' : iN]]$
            \end{itemize}

            To infer $[[Γ ; Φ ⊨ let x = v(args); c' : nf(iN)]]$, 
            let us apply the corresponding algorithmic rule 
            (\ruleref{\ottdruleATAppLetLabel}):
            \begin{enumerate}
                \item $[[Γ ; Φ ⊨ v : ↓nf(iM)]]$ holds as noted above;

                \item $[[Γ; Φ ; · ⊨ nf(uM) ● args ⇒> ↑uP ⫤ Θ; SC]]$ holds as noted above;

                \item To show $[[uv uP ⊆ dom(SC)]]$ and 
                    $[[SC | uv uP singular with uσ0]]$ (for some $[[uσ0]]$),
                    we apply \cref{lemma:singularity-completeness}.
                    Let us show that the premise of this lemma holds.

                    As noted in \ref{point:typing-completeness:AppLet:ih-sound},
                    for any $[[uσ]]$, $[[Θ ⊢ uσ : SC]]$ implies 
                    $[[Γ ⊢ [uσ]uM' ≈ ↑iQ]]$,
                    which is rewritten as $[[Γ ⊢ [uσ]uP ≈ iQ]]$.
                    And since $[[Γ ⊢ [uσ']uP ≈ iQ]]$, 
                    we have $[[Γ ⊢ [uσ]uP ≈ [uσ']uP]]$.
                    It implies $[[Θ ⊢ uσ ≈ uσ' : uv uP]]$
                    by \cref{lemma:subst-equiv-metavar}.

                \item Let us show $[[Γ; Φ, x:[uσ0]uP ⊨ c' : nf(iN)]]$.
                    By the soundness of singularity 
                    (\cref{lemma:singularity-soundness}),
                    we have $[[Θ ⊢ uσ0 : SC]]$,
                    which by \ref{point:typing-completeness:AppLet:ih-sound}
                    means $[[Γ ⊢ [uσ0]uM' ≈ ↑iQ]]$,
                    that is $[[Γ ⊢ [uσ0]uP ≈ iQ]]$, 
                    and thus, $[[Γ ⊢ Φ, x:iQ ≈ Φ, x:[uσ0]uP]]$.

                    Then by \cref{lemma:decl-typing-context-equiv},
                    $[[Γ; Φ, x:iQ ⊢ c' : iN]]$ can be rewritten as
                    $[[Γ; Φ, x:[uσ0]uP ⊢ c' : iN]]$.
                    Then by the induction hypothesis applied to it, 
                    $[[Γ; Φ, x:[uσ0]uP ⊨ c' : nf(iN)]]$ holds.
            \end{enumerate}

        \item \ruleref{\ottdruleDTForallAppLabel}\\
            Since $[[uN]]$ cannot be a metavariable,  
            if $[[ [uσ]uN ]]$ starts with $[[∀]]$,
            so does $[[uN]]$. This way,
            $[[uN = ∀pas.uN1]]$.
            Then by assumption:
            \begin{enumerate}
                \item $[[Γ ⊢ Θ]]$
                \item $[[Γ; Θ ⊢ ∀pas.uN1]]$ is free from negative metavariables, 
                    and then $[[Γ, pas; Θ ⊢ uN1]]$ is free from negative metavariables too;
                \item $[[Θ ⊢ uσ]]$;
                \item $[[Γ ⊢ iM]]$;
                \item $[[Γ; Φ ⊢ [uσ]∀pas.uN1 ● args ⇒> iM]]$, 
                    \label{point:typing-completeness-forall-app-inversion}
                    that is $[[Γ; Φ ⊢ (∀pas.[uσ]uN1) ● args ⇒> iM]]$.
                    Then by inversion there exists $[[σ]]$ such that 
                    \begin{enumerate}
                        \item $[[Γ ⊢ σ : pas]]$;
                        \item $[[args ≠ ·]]$ and $[[pas ≠ ·]]$; and
                        \item $[[Γ ; Φ ⊢ [σ][uσ]uN1 ● args ⇒> iM]]$.
                            \label{point:typing-completeness-forall-app-inversion-2}
                            Notice that $[[σ]]$ and $[[uσ]]$ commute because 
                            the codomain of $[[σ]]$ does not contain
                            metavariables (and thus, does not intersect with 
                            the domain of $[[uσ]]$), and the codomain of $[[uσ]]$ is 
                            $[[Γ]]$ and does not intersect with $[[pas]]$---the domain of $[[σ]]$.

                            Let us construct $[[uN0]]$ = $[[ [â⁺*/pas]uN1 ]]$
                            and $[[Θ, â⁺*[Γ] ⊢ uσ0]]$ defined as
                            $$
                            \begin{cases}
                                [[ [uσ0]αî⁺ = [σ]αi⁺ ]] & \text{for $[[αî⁺]] \in  [[â⁺*]]$ }\\
                                [[ [uσ0]β̂± = [uσ]β̂± ]] & \text{for $[[β̂±]] \in [[dom(Θ)]]$}
                            \end{cases}
                            $$

                            Then it is easy to see that $[[ [uσ0][â⁺*/pas]uN1 = [σ][uσ]uN1 ]]$
                            because this substitution compositions coincide on 
                            $[[ {pas} ∪ dom(Θ) ]]$, their domain.
                            In other words, $[[ [uσ0]uN0 = [σ][uσ]uN1 ]]$.

                            Then let us apply the induction hypothesis
                            to $[[Γ; Φ ⊢ [uσ0]uN0 ● args ⇒> iM]]$ and obtain 
                            $[[uM']]$, $[[Θ']]$, and $[[SC]]$ such that
                            \begin{itemize}
                                \item $[[ Γ; Φ; Θ, â⁺*[Γ] ⊨ uN0 ● args ⇒> uM' ⫤ Θ'; SC ]]$ and
                                \item \label{point:typing-completeness-forall-app-inversion-3}
                                for any $[[Θ, â⁺*[Γ]  ⊢ uσ0]]$ and $[[Γ ⊢ iM]]$
                                    such that $[[Γ; Φ ⊢ [uσ0]uN0 ● args ⇒> iM]]$, 
                                    there exists $[[uσ0']]$ such that 
                                \begin{enumerate}
                                    \item $[[Θ' ⊢ uσ0' : SC]]$,
                                    \item $[[Θ, â⁺*[Γ] ⊢ uσ0' ≈ uσ0 : dom(Θ) ∪ {â⁺*}]]$, and 
                                    \item $[[Γ ⊢ [uσ0']uM' ≈ iM]]$.
                                \end{enumerate}
                            \end{itemize}
                    \end{enumerate}
            \end{enumerate}
            Let us take $[[uM']]$, $[[Θ']]$, and $[[SC]]$ from the induction hypothesis
            (\ref{point:typing-completeness-forall-app-inversion-2}) and show they 
            satisfy the required properties.
            \begin{enumerate}
                \item to infer $[[ Γ; Φ; Θ ⊨ ∀pas.uN1 ● args ⇒> uM' ⫤ Θ'; SC ]]$
                    we apply the corresponding algorithmic rule \ruleref{\ottdruleATForallAppLabel},
                    not that the required premises hold, as noted above:
                    \begin{enumerate}
                        \item $[[args ≠ ·]]$, $[[pas ≠ ·]]$; and
                        \item $[[Γ; Φ; Θ, â⁺*[Γ] ⊨ [â⁺*/pas]uN1 ● args ⇒> uM' ⫤ Θ'; SC]]$
                            is obtained by unfolding the definition of $[[uN0]]$
                            in $[[ Γ; Φ; Θ, â⁺*[Γ] ⊨ uN0 ● args ⇒> uM' ⫤ Θ'; SC ]]$
                            (\ref{point:typing-completeness-forall-app-inversion-2}).
                    \end{enumerate}
                \item Let us take and arbitrary $[[Θ ⊢ uσ]]$ and $[[Γ ⊢ iM]]$
                    and assume $[[Γ; Φ ⊢ [uσ]∀pas.uN1  ● args ⇒> iM]]$. 
                    Then the same reasoning as in 
                    \ref{point:typing-completeness-forall-app-inversion-2}
                    applies. In particular, we construct 
                    $[[Θ, â⁺*[Γ] ⊢ uσ0]]$ as an extension of $[[uσ]]$
                    and obtain 
                    $[[Γ; Φ ⊢ [uσ0]uN0 ● args ⇒> iM]]$.

                    It means, we can apply the property inferred from the induction 
                    hypothesis (\ref{point:typing-completeness-forall-app-inversion-3})
                    to obtain $[[uσ0']]$ such that 
                    \begin{enumerate}
                        \item $[[Θ' ⊢ uσ0' : SC]]$,
                        \item $[[Θ, â⁺*[Γ] ⊢ uσ0' ≈ uσ0 : dom(Θ) ∪ {â⁺*}]]$, and 
                        \item $[[Γ ⊢ [uσ0']uM' ≈ iM]]$.
                    \end{enumerate}

                    Let us show that the obtained $[[uσ0']]$ satisfies the required properties.
                    \begin{enumerate}
                        \item $[[Θ' ⊢ uσ0' : SC]]$ holds as shown,
                        \item $[[Γ ⊢ [uσ0']uM' ≈ iM]]$ holds as shown,
                        \item $[[Θ ⊢ uσ0' ≈ uσ : dom(Θ)]]$,
                            holds. Let us take an arbitrary 
                            $[[β̂±]] \in [[dom(Θ)]] \subseteq [[dom(Θ) ∪ {â⁺*}]]$. Then 
                            since $[[Θ, â⁺*[Γ] ⊢ uσ0' ≈ uσ0 : dom(Θ) ∪ {â⁺*}]]$, 
                            we have $[[ [uσ0']β̂±  = [uσ0]β̂± ]]$ and 
                            by definition of $[[uσ0]]$, $[[ [uσ0]β̂±  = [uσ]β̂± ]]$.
                    \end{enumerate}
            \end{enumerate}
            
        \item \ruleref{\ottdruleDTArrowAppLabel}\\
            Since $[[uN]]$ cannot be a metavariable,  
            if the shape of $[[ [uσ]uN ]]$ is an arrow, 
            so is the shape of $[[uN]]$. This way, 
            $[[uN = uQ → uN1]]$.
            Then by assumption:
            \begin{enumerate}
                \item $[[Γ ⊢ Θ]]$;
                \item $[[Γ; Θ ⊢ uQ → uN1]]$ is free from negative metavariables;
                \item $[[Θ ⊢ uσ]]$;
                \item $[[Γ ⊢ iM]]$;
                \item $[[Γ; Φ ⊢ [uσ](uQ → uN1) ● v, args ⇒> iM]]$, 
                    \label{point:typing-completeness-arrow-app-inversion}
                    that is $[[Γ; Φ ⊢ ([uσ]uQ → [uσ]uN1) ● v, args ⇒> iM]]$,
                    and by inversion:
                    \begin{enumerate}
                        \item $[[Γ; Φ ⊢ v : iP]]$,
                            and by the induction hypothesis, 
                            $[[Γ; Φ ⊨ v : nf(iP)]]$;
                        \item $[[Γ ⊢ [uσ]uQ ≥ iP]]$, 
                            which by transitivity (\cref{lemma:subtyping-transitivity}) means 
                            $[[Γ ⊢ [uσ]uQ ≥ iP']]$,
                            and then by completeness of subtyping 
                            (\cref{lemma:pos-subt-completeness}),
                            $[[ Γ; Θ ⊨ uQ ≥ iP' ⫤ SC1 ]]$, 
                            for some $[[Θ ⊢ SC1]]$, and moreover, $[[Θ ⊢ uσ : SC1]]$;
                        \item $[[Γ; Φ ⊢ [uσ]uN1 ● args ⇒> iM]]$. 
                            \label{point:completeness-arrow-app-ih}
                            Notice that the induction hypothesis is applicable to this case:
                            $[[Γ ; Θ ⊢ uN1]]$ is free from negative metavariables because
                            so is $[[uQ → uN1]]$. This way, there exist 
                            $[[uM']]$, $[[Θ']]$, and $[[SC2]]$ such that 
                            \begin{enumerate}
                                \item $[[ Γ; Φ; Θ ⊨ uN1 ● args ⇒> uM' ⫤ Θ'; SC2 ]]$
                                    and then by the soundness of typing 
                                    (i.e. the induction hypothesis), 
                                    \begin{enumerate}
                                        \item $[[Θ ⊆ Θ']]$
                                        \item $[[Γ; Θ' ⊢ uM']]$
                                    \end{enumerate}
                                \item  \label{point:new-subdst}
                                    for any $[[Θ ⊢ uσ]]$ and $[[Γ ⊢ iM]]$
                                    such that $[[Γ; Φ ⊢ [uσ]uN1 ● args ⇒> iM]]$, 
                                    there exists $[[uσ']]$ such that 
                                    \begin{enumerate}
                                        \item $[[Θ' ⊢ uσ' : SC2]]$,
                                        \item $[[Θ ⊢ uσ' ≈ uσ : dom(Θ)]]$, and 
                                        \item $[[Γ ⊢ [uσ']uM' ≈ iM]]$.
                                    \end{enumerate}
                            \end{enumerate}
                    \end{enumerate}
            \end{enumerate}

            Let us take $[[Θ ⊢ uσ]]$ and $[[iM]]$
            and construct $[[Θ' ⊢ uσ']]$ 
            by the induction hypothesis (\ref{point:new-subdst}).
            Then $[[Θ' ⊢ uσ' : SC2]]$ and $[[Θ' ⊢ uσ' : SC1]]$ 
            holds and since $[[Θ ⊢ uσ : SC1]]$ and $[[Θ ⊢ uσ' ≈ uσ : dom(Θ)]]$.
            Then by the completeness of constraint merge 
            (\cref{lemma:merge-completeness}),
            $[[Θ' ⊢ SC1 & SC2 = SC]]$ exists, $[[Θ' ⊢ SC]]$, and 
            $[[Θ' ⊢ uσ : SC]]$.

            To show the required properties, we take
            $[[uM']]$ and $[[Θ']]$ from the induction hypothesis (\ref{point:new-subdst}), 
            and $[[SC]]$ defined above. Then
            \begin{enumerate}
                \item $[[ Γ; Φ; Θ ⊨ uQ → uN1 ● v,args ⇒> uM' ⫤ Θ'; SC ]]$
                    is inferred by \ruleref{\ottdruleATArrowAppLabel}:
                    \begin{enumerate}
                        \item $[[Γ; Φ ⊨ v : iP']]$ as noted above,
                        \item $[[Γ; Θ ⊨ uQ ≥ iP' ⫤ SC1]]$ as noted above,
                        \item $[[Γ; Φ; Θ ⊨ uN1 ● args ⇒> uM' ⫤ Θ'; SC2]]$ as noted above;
                    \end{enumerate}
                \item let us take an arbitrary $[[Θ ⊢ uσ0]]$ and $[[Γ ⊢ iM0]]$
                    such that $[[Γ; Φ ⊢ [uσ0](uQ → uN1) ● v,args ⇒> iM0]]$.
                    Then by inversion
                    of $[[Γ; Φ ⊢ [uσ0]uQ → [uσ0]uN1 ● v,args ⇒> iM0]]$,
                    we have the same properties as in 
                    \ref{point:typing-completeness-arrow-app-inversion}.
                    In particular,
                    \begin{itemize}
                        \item $[[Γ; Φ ⊢ [uσ0]uN1 ● args ⇒> iM0]]$. 
                            Then by \ref{point:new-subdst}, there exists $[[uσ']]$ such that 
                            \begin{enumerate}
                                \item $[[Θ' ⊢ uσ' : SC2]]$,
                                \item $[[Θ ⊢ uσ' ≈ uσ0 : dom(Θ)]]$, and 
                                \item $[[Γ ⊢ [uσ']uM' ≈ iM0]]$.
                            \end{enumerate}
                        \item $[[Γ ⊢ [uσ0]uQ ≥ iP']]$
                            and by the completeness of subtyping 
                            (\cref{lemma:pos-subt-completeness}),
                            $[[ Θ ⊢ uσ0 : SC1 ]]$.
                    \end{itemize}
                    This way,
                    \begin{itemize}
                        \item $[[Θ ⊢ uσ' ≈ uσ0 : dom(Θ)]]$ holds as noted above;
                        \item $[[Θ' ⊢ uσ' : SC1]]$ holds because $[[Θ ⊢ uσ0 : SC1]]$ and 
                            $[[Θ ⊢ uσ' ≈ uσ0 : dom(Θ)]]$, 
                            and $[[Θ' ⊢ uσ' : SC1]]$ together with $[[Θ' ⊢ uσ' : SC2]]$  
                            implies $[[Θ' ⊢ uσ' : SC]]$ by the completeness of constraint merge 
                            (\cref{lemma:merge-completeness}); and
                        \item $[[Γ ⊢ [uσ']uM' ≈ iM0]]$ holds as noted above.
                    \end{itemize}
            \end{enumerate}

        \item \ruleref{\ottdruleDTEmptyAppLabel}\\
            By assumption: 
            \begin{enumerate}
                \item $[[Γ ⊢ Θ]]$,
                \item $[[Γ; Θ ⊢ uN]]$,
                \item $[[Θ ⊢ uσ]]$,
                \item $[[Γ; Φ ⊢ [uσ]uN ● · ⇒> [uσ]uN ]]$.
            \end{enumerate}
            Then we can apply the corresponding algorithmic rule
            \ruleref{\ottdruleATEmptyAppLabel} to infer
            $[[ Γ; Φ; Θ ⊨ uN ● · ⇒> nf(uN) ⫤ Θ; · ]]$.
            Let us show the required properties. 
            Let us take an arbitrary 
            $[[Θ ⊢ uσ1]]$ and $[[Γ ⊢ iM]]$
            such that $[[Γ; Φ ⊢ [uσ1]uN ● · ⇒> iM]]$. 
            Then we can take $[[uσ' = uσ1]]$:
            \begin{enumerate}
                \item $[[Θ ⊢ uσ' : ·]]$ holds vacuously,
                \item $[[Θ ⊢ uσ' ≈ uσ1 : dom(Θ)]]$ holds by reflexivity of equivalence,
                \item Let us show $[[Γ ⊢ [uσ']nf(uN) ≈ iM]]$.
                    Notice that $[[Γ; Φ ⊢ [uσ1]uN ● · ⇒> iM]]$ can only be inferred by 
                    \ruleref{\ottdruleDTEmptyAppLabel}, and thus, $[[ Γ ⊢ [uσ1]uN ≈ iM ]]$.
                    By \cref{corollary:nf-pres-subt},
                    $[[Γ ⊢ [uσ1]uN ≈ [uσ1]nf(uN)]]$,
                    and then by transitivity, $[[Γ ⊢ [uσ1]nf(uN) ≈ iM]]$,
                    that is $[[Γ ⊢ [uσ']nf(uN) ≈ iM]]$.
            \end{enumerate}
    \end{caseof}
\end{proof}
