\begin{lemma}[Soundness of well-formedness]
    \label{lemma:wf-soundness}
    \hfill

  \begin{itemize}
    \item[$+$] if $[[Γ ⊢ iP]]$ then $[[fv(iP) ⊆ {Γ}]]$;
    \item[$-$] if $[[Γ ⊢ iN]]$ then $[[fv(iN) ⊆ {Γ}]]$.
  \end{itemize}
\end{lemma}
\begin{proof}
  The proof is done by a simple structural induction on 
  $[[Γ⊢ iP]]$ and mutually, $[[Γ ⊢ iN]]$.
  \begin{caseof}
    \item $[[Γ ⊢ α±]]$ means by inversion that $[[α±]] \in [[Γ]]$,
      that is, $[[α±]] = [[fv(α±) ⊆ {Γ}]]$.
    \item $[[Γ ⊢ iQ → iM]]$ means by inversion that
      $[[Γ ⊢ iQ]]$ and $[[Γ ⊢ iM]]$.
      Then by the induction hypothesis, $[[fv(iQ) ⊆ {Γ}]]$ and $[[fv(iM) ⊆ {Γ}]]$,
      and hence, $[[fv(iQ → iM) = fv(iQ) ∪ fv(iM)]] \subseteq [[{Γ}]]$.
    \item the cases when $[[iP = ↓iN']]$ or $[[iN = ↑iP']]$ are proven analogously.
    \item $[[Γ ⊢ ∀pas.iM]]$ means by inversion that $[[Γ, pas ⊢ iM]]$.
      Then by the induction hypothesis, $[[fv(iM) ⊆ {Γ, pas}]]$, and hence,
      $[[fv(∀pas.iM) = fv(iM) \ {pas}]] \subseteq [[{Γ, pas} \ {pas} = {Γ}]]$.
    \item The case $[[iP = ∃nas.iQ]]$ is proven analogously.
  \end{caseof}
\end{proof}

\begin{lemma}[Completeness of well-formedness]
  \label{lemma:wf-ctxt-equiv}

  In the well-formedness judgment, only used variables matter:
  \begin{itemize}
  \item[$+$] if $[[{Γ1} ∩ fv iP]] = [[{Γ2} ∩ fv iP]]$ then
    $[[Γ1 ⊢ iP]] \iff [[Γ2 ⊢ iP]]$,
  \item[$-$] if $[[{Γ1} ∩ fv iN]] = [[{Γ2} ∩ fv iN]]$ then
    $[[Γ1 ⊢ iN]] \iff [[Γ2 ⊢ iN]]$.
  \end{itemize}
\end{lemma}
\begin{proof}
  By simple mutual induction on $[[iP]]$ and $[[iN]]$.
\end{proof}

\begin{corollary}[Context Strengthening]
  \label{corollary:wf-ctxt-strengthening}
  \hfill
  
  \begin{itemize}
    \item [$+$] If $[[Γ ⊢ iP]]$ then $[[Ord fv(iP) ⊢ iP]]$;
    \item [$-$] If $[[Γ ⊢ iN]]$ then $[[Ord fv(iN) ⊢ iN]]$.
  \end{itemize}
\end{corollary}
\begin{proof}
  It follows from \cref{lemma:wf-ctxt-equiv} and \cref{lemma:wf-soundness}.
  \begin{itemize}
    \item [$+$] 
      By \cref{lemma:wf-soundness}, $[[fv(iP) ⊆ {Γ}]]$, and hence,
      $[[{Γ} ∩ fv iP = fv iP ]]$, which makes \cref{lemma:wf-ctxt-equiv}
      applicable fore contexts $[[Γ]]$ and $[[Ord fv(iP)]]$.
    \item[$-$] The negative case is proven analogously.
  \end{itemize}

\begin{corollary}[Well-formedness Context Weakening]
  \label{lemma:wf-weakening}
  Suppose that $[[{Γ1} ⊆ {Γ2}]]$, then
  \begin{itemize}
    \item[$+$] if $[[Γ1 ⊢ iP]]$ then $[[Γ2 ⊢ iP]]$,
    \item[$-$] if $[[Γ1 ⊢ iN]]$ then $[[Γ2 ⊢ iN]]$.
  \end{itemize}
\end{corollary}
\begin{proof}
  By \cref{lemma:wf-soundness},
  $[[Γ1 ⊢ iP]]$ implies $[[fv(iP) ⊆ {Γ1}]]$,
  which means that $[[fv(iP) ⊆ {Γ2}]]$,
  and thus, $[[fv(iP)]] = [[fv(iP) ∩ {Γ1}]] = [[fv(iP) ∩ {Γ2}]]$.
  Then by \cref{lemma:wf-ctxt-equiv}, $[[Γ2 ⊢ iP]]$. 
  The negative case is symmetric.
\end{proof}


\begin{corollary}
  \label{lemma:mut-sub-types-wf-equiv}
  Suppose that all the types below are well-formed in $[[Γ]]$ and
  $[[{Γ'} ⊆ {Γ}]]$. Then
  \begin{itemize}
  \item[$+$] $[[Γ ⊢ iP ≈ iQ]]$ implies $[[Γ' ⊢ iP]] \iff [[Γ' ⊢ iQ]]$
  \item[$-$] $[[Γ ⊢ iN ≈ iM]]$ implies $[[Γ' ⊢ iN]] \iff [[Γ' ⊢ iM]]$
  \end{itemize}
\end{corollary}
\begin{proof}
  From \cref{lemma:wf-ctxt-equiv,corollary:fv-mut-sub}.
\end{proof}



\begin{lemma}[Well-formedness agrees with substitution]
  \label{lemma:wf-subst}
  Suppose that $[[Γ2 ⊢ σ : Γ1]]$. Then
  \begin{itemize}
  \item[$+$] $[[Γ, Γ1 ⊢ iP]]$ implies $[[Γ, Γ2 ⊢ [σ]iP]]$, and
  \item[$-$] $[[Γ, Γ1 ⊢ iN]]$ implies $[[Γ, Γ2 ⊢ [σ]iN]]$.
  \end{itemize}
\end{lemma}
\begin{proof}
  We prove it by induction on $[[Γ, Γ1 ⊢ iP]]$ and mutually, on $[[Γ, Γ1 ⊢ iN]]$.
  Let us consider the last rule used in the derivation.
  \begin{caseof}
    \item \ruleref{\ottdruleWFTPVarLabel}, 
      i.e. $[[iP]]$ is $[[α⁺]]$.\\
      By inversion, $[[α⁺ ∊ {Γ, Γ1}]]$, then
      \begin{itemize}
        \item if $[[α⁺ ∊ {Γ1}]]$ then $[[ Γ2 ⊢ [σ]α⁺ ]]$, 
          and by weakening (\cref{lemma:wf-weakening}),
          $[[ Γ, Γ2 ⊢ [σ]α⁺ ]]$;
        \item if $[[α⁺ ∊ {Γ} \ {Γ1}]]$ then $[[ [σ]α⁺ = α⁺ ]]$,
          and by \ruleref{\ottdruleWFTPVarLabel}, $[[ Γ, Γ2 ⊢ α⁺ ]]$.
      \end{itemize}

    \item \ruleref{\ottdruleWFTShiftULabel},
      i.e. $[[iP]]$ is $[[↓iN]]$.\\
      Then $[[Γ, Γ1 ⊢ ↓iN]]$ means $[[Γ, Γ1 ⊢ iN]]$ by inversion,
      and by the induction hypothesis, $[[Γ, Γ2 ⊢ [σ]iN]]$.
      Then by  \ruleref{\ottdruleWFTShiftULabel}, $[[Γ, Γ2 ⊢ ↓[σ]iN]]$, 
      which by definition of substitution is rewritten as $[[Γ, Γ2 ⊢ [σ]↓iN]]$.

    \item \ruleref{\ottdruleWFTExistsLabel},
      i.e. $[[iP]]$ is $[[∃nas.iQ]]$.\\
      Then $[[Γ, Γ1 ⊢ ∃nas.iQ]]$ means $[[Γ, nas, Γ1 ⊢ iQ]]$ 
      by inversion, and by the induction hypothesis, 
      $[[Γ, nas, Γ2 ⊢ [σ]iQ]]$.
      Then by  \ruleref{\ottdruleWFTExistsLabel}, 
      $[[Γ, nas, Γ2 ⊢ ∃nas.[σ]iQ]]$, 
      which by definition of substitution is rewritten as 
      $[[Γ, Γ2 ⊢ [σ]∃nas.iQ]]$.

    \item The negative cases are proved symmetrically.
  \end{caseof}

\end{proof}